% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/genomewide_analysis.R
\name{genomewide_analysis}
\alias{genomewide_analysis}
\title{Genome-Wide Spatial Interaction Analysis}
\usage{
genomewide_analysis(
  data,
  factor_genes = NULL,
  target_genes = NULL,
  radii = c(20, 50, 100, 200, 300, 500),
  pairs = NULL,
  quantile_probs = 0.25,
  use_annular = FALSE,
  annular_width = 20,
  annular_mode = c("constant_width", "variable"),
  output_dir = NULL,
  method = c("streaming", "matrix"),
  sigma_factor = 1/3,
  min_cells = 10,
  min_connections = 10,
  n_perm = 0,
  fdr_threshold = 0.05,
  batch_size = 100,
  verbose = TRUE
)
}
\arguments{
\item{data}{SCData object or list with expr, coords, cell_types, gene_names}

\item{factor_genes}{Character vector of factor genes to analyze (default: all genes)}

\item{target_genes}{Character vector of target genes (default: all genes)}

\item{radii}{Numeric vector of distance radii (default: c(20, 50, 100, 200, 300, 500))}

\item{pairs}{Cell type pairs matrix (2 columns: sender, receiver). NULL = all pairs.}

\item{quantile_probs}{Expression quantile thresholds (default: 0.25). Can be vector
for multi-quantile analysis.}

\item{use_annular}{Use annular (ring) weights (default: FALSE)}

\item{annular_width}{Width of annular ring in microns (default: 20)}

\item{annular_mode}{"constant_width" (default) or "variable" (uses radii intervals)}

\item{output_dir}{Directory for HDF5 output (NULL = return in memory)}

\item{method}{"streaming" (default, memory-efficient) or "matrix" (faster for small data)}

\item{sigma_factor}{Gaussian sigma = radius * sigma_factor (default: 1/3)}

\item{min_cells}{Minimum cells per type (default: 10)}

\item{min_connections}{Minimum neighbor connections (default: 10)}

\item{n_perm}{Number of permutations for significance testing (default: 0)}

\item{fdr_threshold}{FDR threshold for significance (default: 0.05)}

\item{batch_size}{Gene batch size for memory management (default: 100)}

\item{verbose}{Print progress (default: TRUE)}
}
\value{
GenomewideResult object with:
\describe{
\item{results}{List of Moran's I results per pair}
\item{delta_I}{Delta I values per gene pair (if computed)}
\item{pair_stats}{Data frame with pair statistics}
\item{metadata}{Analysis parameters}
}
}
\description{
Unified entry point for genome-wide spatial analysis, equivalent to
Python's unified_genomewide_interaction.py. Computes Moran's I for
factor-target gene pairs across cell type pairs and radii.
}
\details{
CPU-optimized for cross-platform compatibility (Mac Intel/M1, Linux, Windows).
Uses KD-tree for efficient neighbor search and BLAS-accelerated matrix operations.
\subsection{Computational Methods}{

\strong{Streaming Mode} (default): Computes weights on-the-fly without storing
explicit weight matrix. Uses KD-tree for O(n log n) neighbor search.
Memory usage: O(n_genes^2) for result matrix only.

\strong{Matrix Mode}: Pre-computes sparse weight matrix. Faster for repeated
computations on same cell configuration. Memory: O(n_edges) for weights.
}

\subsection{Platform Optimization}{
\itemize{
\item Uses RcppArmadillo with system BLAS (vecLib on Mac, OpenBLAS on Linux)
\item KD-tree neighbor search via nanoflann (header-only, cross-platform)
\item Automatic method selection based on dataset size
}
}

\subsection{Multi-Quantile Analysis}{

When quantile_probs is a vector, the analysis is performed for each
quantile threshold. This allows exploration of how spatial correlations
change with expression level cutoffs.
}

\subsection{Annular (Ring) Weights}{

When use_annular = TRUE, only neighbors within an annular region are
considered. This isolates signals at specific distance ranges and is
useful for identifying paracrine vs juxtacrine interactions.
}
}
\examples{
\dontrun{
# Load data
data <- load_data_cosmx("expr.csv", "meta.csv")

# Basic analysis
result <- genomewide_analysis(
    data,
    factor_genes = c("TGFB1", "IFNG", "TNF"),
    radii = c(50, 100, 200, 300)
)

# Memory-efficient streaming with HDF5 output
genomewide_analysis(
    data,
    factor_genes = c("TGFB1"),
    radii = seq(20, 500, by = 20),
    output_dir = "results/",
    method = "streaming"
)

# Annular (ring) analysis for paracrine signals
result <- genomewide_analysis(
    data,
    use_annular = TRUE,
    annular_width = 20,
    radii = c(50, 100, 200)
)

# Multiple quantile thresholds
result <- genomewide_analysis(
    data,
    quantile_probs = c(0, 0.25, 0.50),
    radii = c(100, 200)
)
}

}
