% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RcppExports.R
\name{batch_permutation_test_cpp}
\alias{batch_permutation_test_cpp}
\title{Batch Permutation Test for Multiple Genes}
\usage{
batch_permutation_test_cpp(z_f, Z_g, W, metric, n_perm, weight_sum = -1)
}
\arguments{
\item{z_f}{Standardized factor expression vector (length n_obs)}

\item{Z_g}{Gene expression matrix (n_obs x n_genes), genes in columns}

\item{W}{Sparse weight matrix (n_obs x n_obs) for computing spatial lags}

\item{metric}{String: "moran" or "ind"}

\item{n_perm}{Number of permutations (default: 999)}

\item{weight_sum}{Sum of weights for normalization. If <= 0, uses n_obs.}
}
\value{
DataFrame with columns:
\itemize{
\item gene_idx: Gene index (1-based)
\item I_obs: Observed statistic (Moran's I or I_ND)
\item p_value: Two-sided p-value
\item z_score: Z-score relative to null
\item null_sd: Standard deviation of the null distribution
}
}
\description{
Efficiently tests all genes against one factor. Pre-generates permutation
indices once and reuses them across all genes.
}
\details{
Key optimizations:
\enumerate{
\item Permutation indices are generated ONCE and reused for all genes
\item Spatial lag is computed once per gene
\item User interrupt is checked every 100 genes
}

This function is the workhorse for genome-wide significance testing.
For a typical analysis with 20,000 genes and 999 permutations, this
processes approximately 20 million permutation statistics.
}
