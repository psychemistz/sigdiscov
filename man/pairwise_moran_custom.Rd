% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/custom_weights.R
\name{pairwise_moran_custom}
\alias{pairwise_moran_custom}
\title{Compute Moran's I with Custom Weight Matrix}
\usage{
pairwise_moran_custom(
  data,
  weight_matrix,
  normalize = FALSE,
  mode = "paired",
  verbose = TRUE
)
}
\arguments{
\item{data}{Gene expression matrix (genes x spots). Column names should
match the row/column names of the weight matrix.}

\item{weight_matrix}{Square weight matrix. Can be dense matrix or sparse
Matrix object.}

\item{normalize}{Logical. If TRUE, divide each weight by S0 before
computation. Default: FALSE.}

\item{mode}{Calculation mode: "paired" (all pairs), "single" (univariate
only). Default: "paired".}

\item{verbose}{Print progress messages. Default: TRUE.}
}
\value{
A list containing:
\item{moran}{Moran's I matrix (if mode = "paired") or named vector
(if mode = "single")}
\item{gene_names}{Names of genes}
\item{S0}{Sum of weights used}
}
\description{
Computes pairwise Moran's I using a user-provided spatial weight matrix
instead of computing weights from coordinates.
}
\details{
This function allows using arbitrary spatial weight matrices, enabling:
\itemize{
\item Non-standard spatial relationships
\item Alternative distance metrics
\item Prior biological knowledge about connectivity
}

The weight matrix should typically be symmetric and have zeros on the
diagonal (no self-connections).
}
\examples{
\dontrun{
# Load custom weights
W <- load_weight_matrix("custom_weights.tsv")

# Compute Moran's I
result <- pairwise_moran_custom(data, W)

# Get significant pairs
high_corr <- which(result$moran > 0.5 & lower.tri(result$moran),
                   arr.ind = TRUE)
}

}
