% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RcppExports.R
\name{permutation_test_cpp}
\alias{permutation_test_cpp}
\title{Permutation Test for Spatial Correlation (Single Gene)}
\usage{
permutation_test_cpp(z_f, lag_g, metric, n_perm)
}
\arguments{
\item{z_f}{Standardized factor expression vector (length n)}

\item{lag_g}{Pre-computed spatial lag of gene (W * z_g), same length as z_f}

\item{metric}{String: "moran" for bivariate Moran's I, "ind" for I_ND}

\item{n_perm}{Number of permutations (default: 999)}
}
\value{
List with components:
\itemize{
\item I_obs: Observed statistic value
\item p_value: Two-sided p-value with continuity correction
\item z_score: Z-score relative to null distribution
\item null_mean: Mean of null distribution
\item null_sd: Standard deviation of null distribution
\item n_perm: Number of permutations performed
}
}
\description{
Tests H0: No spatial association between factor and gene expression.
The test permutes factor expression while keeping the spatial lag fixed.
}
\details{
The permutation strategy is:
\enumerate{
\item Compute observed statistic from z_f and lag_g
\item For b = 1 to n_perm:
a. Randomly permute z_f
b. Compute permuted statistic (lag_g stays fixed)
\item p-value = (1 + count(|I_perm| >= |I_obs|)) / (n_perm + 1)
}

The continuity correction (+1 in numerator and denominator) ensures
p-values are never exactly 0.
}
