% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/signed_delta_I.R
\name{compute_signed_delta_I}
\alias{compute_signed_delta_I}
\title{Compute Signed Delta I Signatures for Spatial Transcriptomics}
\usage{
compute_signed_delta_I(
  expr_matrix,
  spot_coords,
  factor_gene,
  radii = seq(100, 600, 100),
  mode = c("bivariate", "directional"),
  sender_percentile = 75,
  smooth_window = 5,
  smooth_poly = 2,
  coord_scale = 1,
  verbose = TRUE
)
}
\arguments{
\item{expr_matrix}{A matrix of gene expression values (genes x spots). VST-normalized values are recommended.}

\item{spot_coords}{Spot coordinates as a data frame with row/col columns, or a 2-column matrix in physical units.}

\item{factor_gene}{Name or row index of the factor gene.}

\item{radii}{Numeric vector of distance bin edges in same units as coordinates. Default: seq(100, 600, 100).}

\item{mode}{Computation mode: "bivariate" (symmetric) or "directional" (I_ND with sender/receiver). Default: "bivariate".}

\item{sender_percentile}{For directional mode: percentile threshold for senders. Default: 75.}

\item{smooth_window}{Savitzky-Golay smoothing window size (must be odd). Default: 5.}

\item{smooth_poly}{Savitzky-Golay polynomial order. Default: 2.}

\item{coord_scale}{Scale factor for coordinates. For Visium grid, use ~100 for micrometers. Default: 1.}

\item{verbose}{Print progress messages. Default: TRUE.}
}
\value{
A data frame with columns: gene, delta_I, delta_I_signed, sign, I_short, I_long, I_max, I_min, auc, peak_radius_idx.
}
\description{
Computes distance-dependent spatial correlation between a factor gene and all
other genes, then derives signed delta I signatures. This helps distinguish
true responsive genes from constitutively expressed genes.
}
\details{
The function computes bivariate Moran's I (or directional I_ND) at multiple
distance bins, creating an I(r) curve. This curve is smoothed using a
Savitzky-Golay filter, then signed delta I is computed based on the trend.

Interpretation: delta_I_signed > 0 indicates decay pattern (TRUE RESPONDER),
delta_I_signed < 0 indicates increase pattern (AVOIDANCE), and values near
zero indicate flat pattern (CONSTITUTIVE expression).

Mode "bivariate" uses all spots symmetrically for general spatial pattern
discovery. Mode "directional" uses explicit sender-receiver directionality
(I_ND cosine similarity) for ligand-receptor signaling analysis.
}
\examples{
\dontrun{
# Load Visium data
visium <- load_visium_data("path/to/spaceranger_output")
visium <- filter_in_tissue(visium)
expr_vst <- vst_transform(visium$counts)
coords <- get_spot_coords(visium)

# Bivariate mode (symmetric)
sig <- compute_signed_delta_I(
  expr_matrix = expr_vst,
  spot_coords = coords,
  factor_gene = "IL1B",
  mode = "bivariate",
  coord_scale = 100  # Convert grid to micrometers
)

# View top responders (decay pattern)
head(sig[order(-sig$delta_I_signed), ])

# Directional mode (sender -> receiver)
sig_dir <- compute_signed_delta_I(
  expr_matrix = expr_vst,
  spot_coords = coords,
  factor_gene = "IL1B",
  mode = "directional",
  sender_percentile = 75
)
}

}
\seealso{
\code{\link{get_moran_curve}} for visualizing individual gene curves,
  \code{\link{pairwise_moran}} for standard pairwise Moran's I.
}
