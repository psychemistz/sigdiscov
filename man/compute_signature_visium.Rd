% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/signature_visium.R
\name{compute_signature_visium}
\alias{compute_signature_visium}
\title{Compute Spatial Signature for Visium Data}
\usage{
compute_signature_visium(
  data,
  factor_gene,
  radii = seq(100, 500, 100),
  metric = c("both", "moran", "ind"),
  mode = c("directional", "bivariate"),
  weight_type = c("gaussian", "binary"),
  sender_percentile = 75,
  compute_delta = TRUE,
  n_perm = 0,
  seed = NULL,
  verbose = TRUE
)
}
\arguments{
\item{data}{A VisiumData list (from \code{\link{load_data_visium}} or
\code{\link{as_data_visium}}).}

\item{factor_gene}{Character. Name of the factor gene (e.g., "IL1B").}

\item{radii}{Numeric vector. Distance radii in coordinate units
(default: seq(100, 500, 100)).}

\item{metric}{Character. Metric to compute: "moran", "ind", or "both"
(default: "both").}

\item{mode}{Character. Analysis mode: "bivariate" (all spots) or
"directional" (sender/receiver split) (default: "directional").}

\item{weight_type}{Character. Weight type: "gaussian" (default, matches
pairwise_moran) or "binary" (legacy row-normalized weights).}

\item{sender_percentile}{Numeric. Percentile threshold for sender selection
(default: 75, meaning top 25 percent of expressors become senders).}

\item{compute_delta}{Logical. Compute signed delta I (default: TRUE).}

\item{n_perm}{Integer. Number of permutations for significance testing.
Set to 0 to skip permutation test (default: 0).}

\item{seed}{Integer. Random seed for reproducibility (optional).}

\item{verbose}{Logical. Print progress messages (default: TRUE).}
}
\value{
A VisiumSignature data.frame with columns: gene, moran_r1/r2/...,
ind_r1/r2/..., moran_r1_val, moran_max, ind_r1_val, ind_max, delta_I,
delta_I_sign, p_value, p_adj, z_score (depending on metric and options).
}
\description{
Main analysis function for computing spatial correlation signatures in
Visium data. Computes Moran's I and/or I_ND across multiple distance radii
for all genes against a specified factor gene.
}
\details{
This function is the main entry point for Visium spatial signature analysis.

Analysis Modes: (1) Bivariate - All spots participate as both senders and
receivers, using a symmetric weight matrix. Appropriate for general
spatial autocorrelation analysis. (2) Directional - Spots are split into
senders (high factor expression) and receivers (low factor expression),
using an asymmetric weight matrix. Appropriate for paracrine signaling analysis.

Metrics: (1) Moran's I - Classic spatial autocorrelation measure, unbounded,
typically ranges from about -1 to +1. (2) I_ND - Normalized directional
Moran's I (cosine similarity), bounded exactly between -1 and +1.
}
\examples{
\dontrun{
# Load data
data <- load_data_visium("path/to/spaceranger")

# Bivariate analysis
sig_bi <- compute_signature_visium(
    data,
    factor_gene = "IL1B",
    metric = "moran",
    mode = "bivariate"
)

# Directional analysis with permutation test
sig_dir <- compute_signature_visium(
    data,
    factor_gene = "IL1B",
    metric = "ind",
    mode = "directional",
    sender_percentile = 75,
    n_perm = 999
)

# Top correlated genes
head(sig_dir[order(-sig_dir$ind_r1_val), ], 20)

# Significant genes
sig_dir[sig_dir$p_adj < 0.05, ]
}

}
\seealso{
\code{\link{load_data_visium}}, \code{\link{as_data_visium}},
\code{\link{split_by_expression}}, \code{\link{create_weights_visium}}
}
