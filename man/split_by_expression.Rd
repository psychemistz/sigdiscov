% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sender_receiver_visium.R
\name{split_by_expression}
\alias{split_by_expression}
\title{Split Spots by Expression Level}
\usage{
split_by_expression(expr, percentile = 75, use_nonzero = TRUE, min_spots = 30)
}
\arguments{
\item{expr}{Numeric vector. Expression values for the factor gene across
all spots.}

\item{percentile}{Numeric. Percentile threshold (default: 75, meaning top
25 percent of expressors become senders).}

\item{use_nonzero}{Logical. Compute threshold using only non-zero values
(default: TRUE). This avoids inflation by zero-expressing spots.}

\item{min_spots}{Integer. Minimum required spots per group (default: 30).
Warns if either group is smaller.}
}
\value{
A list with components:
\describe{
\item{sender_idx}{Integer vector. Indices of sender spots (1-based).}
\item{receiver_idx}{Integer vector. Indices of receiver spots (1-based).}
\item{threshold}{Numeric. Expression threshold used for splitting.}
\item{percentile}{Numeric. Percentile used (echoed from input).}
\item{n_senders}{Integer. Number of sender spots.}
\item{n_receivers}{Integer. Number of receiver spots.}
}
}
\description{
Divides spots into sender and receiver groups based on factor gene
expression level. Senders are high-expressing spots (top percentile),
receivers are the remaining spots.
}
\details{
For Visium data, sender/receiver definition is expression-based because
spots contain mixed cell populations (1-10 cells per spot) and we cannot
use cell type annotations.

The default strategy:
\enumerate{
\item Compute 75th percentile of non-zero expression values
\item Spots with expression >= threshold become senders (top ~25 percent)
\item Remaining spots become receivers
}

Using non-zero values for threshold computation avoids the situation where
many zero-expressing spots would inflate the receiver group.
}
\examples{
# Expression with some zeros
expr <- c(0, 0, 1, 2, 3, 4, 5, 6, 7, 10)
split <- split_by_expression(expr, percentile = 75)
split$n_senders
split$threshold

}
\seealso{
\code{\link{create_directional_weights_visium}}
}
