% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/celltype_pair_analysis.R
\name{compute_celltype_pair_analysis}
\alias{compute_celltype_pair_analysis}
\title{Compute Cell Type Pair Specific Spatial Analysis}
\usage{
compute_celltype_pair_analysis(
  data,
  radii = seq(20, 500, by = 20),
  pairs = NULL,
  min_cells = 10,
  output_dir = NULL,
  compute_moran = TRUE,
  compute_ind = FALSE,
  factor_genes = NULL,
  method = c("streaming", "matrix"),
  sigma_factor = 1/3,
  verbose = TRUE
)
}
\arguments{
\item{data}{SCData list with expr, coords, cell_types, gene_names}

\item{radii}{Numeric vector of distance radii (default: seq(20, 500, by=20))}

\item{pairs}{Character matrix or NULL. Cell type pairs to analyze.
If NULL (default), analyzes all pairs. Format: 2-column matrix with
"sender" and "receiver" columns.}

\item{min_cells}{Minimum cells per type to include pair (default: 10)}

\item{output_dir}{Directory for HDF5 output. If NULL, returns results in memory.}

\item{compute_moran}{Compute pairwise Moran's I (default: TRUE)}

\item{compute_ind}{Compute I_ND factor-gene metric (default: FALSE)}

\item{factor_genes}{Character vector of factor genes for I_ND}

\item{method}{Computation method: "streaming" (default) or "matrix"}

\item{sigma_factor}{Sigma = radius * sigma_factor (default: 1/3)}

\item{verbose}{Print progress messages (default: TRUE)}
}
\value{
If output_dir is NULL, returns list with:
\describe{
\item{delta_I}{List of delta_I matrices per pair}
\item{I_max}{List of I_max matrices per pair}
\item{pair_stats}{Data frame with pair statistics}
}
If output_dir is provided, saves to HDF5 and returns path.
}
\description{
Main entry point for computing spatial correlation metrics (Moran's I, I_ND,
Delta I) across cell type sender-receiver pairs at multiple radii. Designed
for large single-cell spatial datasets with streaming HDF5 output.
}
\details{
Workflow for each cell type pair:
\enumerate{
\item Extract sender and receiver cells
\item For each radius, compute Moran's I matrix (genes x genes)
\item Compute Delta I from I(r) curves
\item Stream results to HDF5 or accumulate in memory
}

Memory usage: ~100 MB per pair (vs 200 GB if all pairs in memory)
}
\examples{
\dontrun{
# Load CosMx data
data <- load_data_cosmx("expr.csv", "meta.csv")

# Compute for all cell type pairs
result <- compute_celltype_pair_analysis(data, radii = seq(50, 500, by=50))

# Specific pairs only
pairs <- matrix(c("Macrophage", "Fibroblast",
                  "Macrophage", "Epithelial"), ncol = 2, byrow = TRUE)
result <- compute_celltype_pair_analysis(data, pairs = pairs)

# With HDF5 output for large analysis
compute_celltype_pair_analysis(data, output_dir = "results/")
}

}
