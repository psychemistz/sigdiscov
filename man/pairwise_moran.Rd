% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/signature_visium.R
\name{pairwise_moran}
\alias{pairwise_moran}
\title{Pairwise Moran's I for Spatial Transcriptomics}
\usage{
pairwise_moran(
  data,
  spot_coords,
  max_radius = 5,
  platform = c("visium", "old"),
  same_spot = FALSE,
  mode = c("paired", "first", "single"),
  sparse_W = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{data}{A matrix or sparse matrix (dgCMatrix) of gene expression values.
Rows are genes, columns are spots.}

\item{spot_coords}{A data frame or matrix with spot coordinates. Should have
columns named 'row' and 'col', or be a 2-column matrix.}

\item{max_radius}{Maximum grid radius for computing distances. Default: 5.}

\item{platform}{Platform type: "visium" (default) or "old".}

\item{same_spot}{Whether to consider the same spot in computation. Default: FALSE.}

\item{mode}{Computation mode: "paired" (all pairs), "first" (pairs with first gene),
or "single" (diagonal only). Default: "paired".}

\item{sparse_W}{Use sparse weight matrix for memory efficiency. Default: TRUE.
Uses ~99\% less memory for the weight matrix with similar computation speed.}

\item{verbose}{Print progress messages. Default: TRUE.}
}
\value{
A matrix of pairwise Moran's I values. For mode="paired", returns a
symmetric matrix where element \link{i,j} is the Moran's I between genes i and j.
}
\description{
Compute pairwise Moran's I statistics between all genes in spatial
transcriptomics data using Gaussian distance decay weights.
}
\details{
This function computes the classic pairwise Moran's I matrix where each
entry (i,j) represents the spatial correlation between gene i and gene j.

Uses Gaussian distance decay weights with sigma=100 for Visium data,
accounting for the hexagonal grid geometry.

When \code{sparse_W = TRUE}, the weight matrix is stored in sparse format,
reducing memory usage from O(n^2) to O(n * k) where k is the average
number of neighbors per spot. This is particularly useful for large datasets.
}
\examples{
\dontrun{
# Load VST-transformed data
data <- read.table("vst.tsv", header=TRUE, row.names=1)
colnames(data) <- gsub("X", "", colnames(data))
data <- as.matrix(data)

# Parse spot coordinates
spot_coords <- parse_spot_names(colnames(data))

# Compute pairwise Moran's I (dense W)
result <- pairwise_moran(data, spot_coords, max_radius = 3)

# Compute with sparse W (memory efficient)
result <- pairwise_moran(data, spot_coords, max_radius = 3, sparse_W = TRUE)
result[1:5, 1:5]
}

}
