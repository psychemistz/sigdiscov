% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/weights_sc.R
\name{pairwise_moran_sc_large}
\alias{pairwise_moran_sc_large}
\title{Compute Pairwise Moran's I for Large Single-Cell Datasets}
\usage{
pairwise_moran_sc_large(
  data,
  coords,
  radius,
  sigma = NULL,
  method = c("auto", "dense", "streaming", "matrix"),
  max_neighbors = 200,
  chunk_size = 500,
  verbose = TRUE
)
}
\arguments{
\item{data}{Gene expression matrix (genes x cells)}

\item{coords}{Cell coordinates (n x 2 matrix)}

\item{radius}{Radius for neighbor search}

\item{sigma}{Gaussian sigma (default: radius/3)}

\item{method}{Method to use: "streaming" (default, no neighbor limit) or
"matrix" (builds explicit W matrix with neighbor limit)}

\item{max_neighbors}{Maximum neighbors per cell when method="matrix" (default: 200)}

\item{verbose}{Print progress messages (default: TRUE)}
}
\value{
List with moran matrix, weight_sum, and n_edges
}
\description{
Scalable computation of pairwise Moran's I using native C++ KD-tree
(nanoflann) for neighbor search. Handles datasets with hundreds of
thousands of cells. No external R package dependencies required.
}
\details{
Two methods are available:
\itemize{
\item \code{"streaming"} (default): Computes spatial lag on-the-fly without
storing the weight matrix. No neighbor limit, memory efficient, fastest.
\item \code{"matrix"}: Builds explicit sparse weight matrix. Uses max_neighbors
limit to control memory usage.
}

Both methods use nanoflann (header-only C++ KD-tree) for O(n log n) neighbor
search. No external R package dependencies required.
}
\examples{
\dontrun{
# CosMx dataset (~100k cells) - streaming (recommended)
result <- pairwise_moran_sc_large(vst_data, coords, radius = 0.1)

# With explicit W matrix and neighbor limit
result <- pairwise_moran_sc_large(vst_data, coords, radius = 0.1,
                                   method = "matrix", max_neighbors = 200)
}

}
